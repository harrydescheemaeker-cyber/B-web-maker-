<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>AI Code Studio Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs/editor/editor.main.css">
    
    <style>
        :root { --bg: #1e1e1e; --nav: #2d2d2d; --accent: #007acc; --green: #27ae60; --purple: #8e44ad; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; height: 100vh; background: var(--bg); color: white; overflow: hidden; }
        #auth-overlay { position: fixed; inset: 0; background: var(--bg); z-index: 1000; display: flex; justify-content: center; align-items: center; }
        .auth-box { background: #252526; padding: 40px; border-radius: 12px; border: 1px solid #444; text-align: center; }
        #home-screen { position: fixed; inset: 0; background: var(--bg); z-index: 200; padding: 40px; overflow-y: auto; display: none; }
        .project-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; margin-top: 30px; }
        .project-card { background: var(--nav); padding: 20px; border-radius: 10px; border: 1px solid #444; cursor: pointer; }
        nav { background: var(--nav); padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #444; }
        #main { display: flex; flex: 1; height: calc(100vh - 60px); }
        #editor { width: 50%; height: 100%; border-right: 1px solid #444; }
        #preview-box { width: 50%; background: white; }
        iframe { width: 100%; height: 100%; border: none; }
        input { padding: 12px; margin: 10px 0; background: #3c3c3c; border: 1px solid #555; color: white; border-radius: 4px; width: 280px; }
        button { cursor: pointer; padding: 10px 20px; border: none; border-radius: 4px; font-weight: bold; }
        .btn-blue { background: var(--accent); color: white; }
        .btn-green { background: var(--green); color: white; }
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.9); display: none; justify-content: center; align-items: center; z-index: 500; }
        .modal-content { background: #252526; padding: 30px; border-radius: 10px; width: 500px; text-align: left; }
        .url-box { background: #111; padding: 10px; border-radius: 4px; margin-bottom: 15px; border: 1px solid #444; font-family: monospace; font-size: 12px; word-break: break-all; cursor: pointer; }
    </style>

    <script>
        const SUPABASE_URL = 'https://vqgimwgmhoxifzmsunxp.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZxZ2ltd2dtaG94aWZ6bXN1bnhwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk3ODUzOTUsImV4cCI6MjA4NTM2MTM5NX0.rAcHlXDoVPmyw5LI3b7VeuDYQzFldZ5CA4_pBq1CO6c';
        
        let sb;
        let editor;
        let huidigProjectID = null;

        window.onload = async () => {
            sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
            const params = new URLSearchParams(window.location.search);
            
            // OPTIE 1: Publiceer Modus (Alleen website)
            if (params.get('view')) {
                const { data } = await sb.from('projecten').select('html_code').eq('id', params.get('view')).single();
                if (data) { document.open(); document.write(data.html_code); document.close(); return; }
            }
            // OPTIE 2: Samenwerk Modus (Editor openen met code)
            if (params.get('edit')) {
                document.getElementById('auth-overlay').style.display = 'none';
                document.getElementById('home-screen').style.display = 'none';
                document.getElementById('editor-nav').style.display = 'flex';
                document.getElementById('main').style.display = 'flex';
                huidigProjectID = params.get('edit');
                const { data } = await sb.from('projecten').select('*').eq('id', huidigProjectID).single();
                if (data && editor) { 
                    editor.setValue(data.html_code);
                    document.getElementById('actieve-titel').innerText = data.naam || "Gedeeld Project";
                }
            }
        };

        async function signUp() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const { error } = await sb.auth.signUp({ email, password });
            if (error) alert(error.message); else alert("Account gemaakt! Log nu in.");
        }

        async function signIn() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const { data, error } = await sb.auth.signInWithPassword({ email, password });
            if (error) alert("Fout: " + error.message);
            else {
                document.getElementById('auth-overlay').style.display = 'none';
                document.getElementById('home-screen').style.display = 'block';
                laadProjecten();
            }
        }

        async function laadProjecten() {
            const { data } = await sb.from('projecten').select('*').order('created_at', { ascending: false });
            const lijst = document.getElementById('project-lijst');
            lijst.innerHTML = '';
            data.forEach(p => {
                const card = document.createElement('div');
                card.className = 'project-card';
                card.innerHTML = `<h3>${p.naam || 'Naamloos'}</h3><p>${new Date(p.created_at).toLocaleDateString()}</p>`;
                card.onclick = () => openProject(p);
                lijst.appendChild(card);
            });
        }

        function nieuwProject() {
            const naam = prompt("Geef je website een naam:");
            if (!naam) return;
            huidigProjectID = null;
            document.getElementById('actieve-titel').innerText = naam;
            document.getElementById('home-screen').style.display = 'none';
            document.getElementById('editor-nav').style.display = 'flex';
            document.getElementById('main').style.display = 'flex';
            if(editor) editor.setValue(`<h1>${naam}</h1>\n<p>Welkom op mijn nieuwe site!</p>`);
        }

        function openProject(p) {
            huidigProjectID = p.id;
            document.getElementById('actieve-titel').innerText = p.naam || "Project";
            document.getElementById('home-screen').style.display = 'none';
            document.getElementById('editor-nav').style.display = 'flex';
            document.getElementById('main').style.display = 'flex';
            if(editor) editor.setValue(p.html_code);
        }

        async function saveProject() {
            const { data: { user } } = await sb.auth.getUser();
            const code = editor.getValue();
            const naam = document.getElementById('actieve-titel').innerText;

            let res;
            if (huidigProjectID) {
                res = await sb.from('projecten').update({ html_code: code, naam: naam }).eq('id', huidigProjectID).select();
            } else {
                res = await sb.from('projecten').insert([{ html_code: code, user_id: user.id, naam: naam }]).select();
            }

            if (res.error) {
                alert("Opslaan mislukt. Run de SQL code in Supabase om de 'naam' kolom toe te voegen!");
            } else {
                huidigProjectID = res.data[0].id;
                const base = window.location.origin + window.location.pathname;
                document.getElementById('publiceer-url').innerText = base + "?view=" + huidigProjectID;
                document.getElementById('samenwerk-url').innerText = base + "?edit=" + huidigProjectID;
                document.getElementById('share-modal').style.display = 'flex';
            }
        }
    </script>
</head>
<body>

<div id="auth-overlay">
    <div class="auth-box">
        <h2>ðŸš€ AI Code Studio</h2>
        <input type="email" id="email" placeholder="E-mail"><br>
        <input type="password" id="password" placeholder="Wachtwoord"><br>
        <button class="btn-blue" onclick="signIn()">Inloggen</button><br>
        <button onclick="signUp()" style="background:none; color:#aaa; margin-top:10px;">Account maken</button>
    </div>
</div>

<div id="home-screen">
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <h1>Mijn Projecten</h1>
        <button class="btn-blue" onclick="nieuwProject()">+ Nieuw Project</button>
    </div>
    <div id="project-lijst" class="project-grid"></div>
</div>

<nav id="editor-nav" style="display:none">
    <div><button onclick="location.reload()" style="background:#444; color:white">< Home</button> <strong id="actieve-titel" style="margin-left:15px;"></strong></div>
    <button class="btn-green" onclick="saveProject()">Opslaan & Delen</button>
</nav>

<div id="main" style="display:none">
    <div id="editor"></div>
    <div id="preview-box"><iframe id="preview"></iframe></div>
</div>

<div id="share-modal" class="modal">
    <div class="modal-content">
        <h2>Kies je link ðŸš€</h2>
        
        <p><strong>1. Live Website (Alleen kijken)</strong></p>
        <div class="url-box" id="publiceer-url" onclick="navigator.clipboard.writeText(this.innerText); alert('Gekopieerd!')"></div>
        
        <p><strong>2. Samenwerken (Code bewerken)</strong></p>
        <div class="url-box" id="samenwerk-url" onclick="navigator.clipboard.writeText(this.innerText); alert('Gekopieerd!')"></div>
        
        <button class="btn-blue" onclick="document.getElementById('share-modal').style.display='none'" style="width:100%">Sluiten</button>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs/loader.min.js"></script>
<script>
    require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs' }});
    require(['vs/editor/editor.main'], function() {
        editor = monaco.editor.create(document.getElementById('editor'), {
            value: "<h1>Start hier</h1>",
            language: 'html', theme: 'vs-dark', automaticLayout: true
        });
        editor.onDidChangeModelContent(() => {
            document.getElementById('preview').srcdoc = editor.getValue();
        });
    });
</script>
</body>
</html>
